SET search_path TO _da_vtschool_2526;

CREATE OR REPLACE FUNCTION _da_vtschool_2526.subjects_not_passed_asc_2526(
    sid VARCHAR,
    cid INTEGER
)
RETURNS TABLE(subject_id INTEGER)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT sc.subject_id
    FROM _da_vtschool_2526.subject_courses sc
    WHERE sc.course_id = cid
    	AND sc.subject_id NOT IN (
     	SELECT s.subject_id
        FROM _da_vtschool_2526.scores s
        JOIN _da_vtschool_2526.enrollments e
        ON e.code = s.enrollment_id
        WHERE e.student = sid
         AND s.score >= 5
         AND e.course = cid
      );
END;
$$;

CREATE OR REPLACE FUNCTION _da_vtschool_2526.subjects_passed_asc_2526(
    sid VARCHAR,
    cid INTEGER
)
RETURNS TABLE(subject_id INTEGER)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT s.subject_id
    FROM _da_vtschool_2526.scores s
    JOIN _da_vtschool_2526.enrollments e 
    ON e.code = s.enrollment_id
    WHERE e.student = sid
     AND e.course = cid
     AND s.score >= 5;
END;
$$;